<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rotam Benim - Basit Login Test</title>
    
    <!-- Tabler CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/css/tabler.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .login-card {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 32px;
            max-width: 1200px;
            width: 100%;
            text-align: center;
        }
        
        .login-logo {
            font-size: 2rem;
            font-weight: 700;
            color: #206bc4;
            margin-bottom: 10px;
        }
        
        .login-subtitle {
            color: #626976;
            margin-bottom: 30px;
        }
        
        .google-btn {
            background: #4285f4;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            margin-bottom: 20px;
        }
        
        .google-btn:hover {
            background: #3367d6;
            transform: translateY(-2px);
        }
        
        .google-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .user-info {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 15px;
        }
        
        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .status-success {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-info {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .logout-btn:hover {
            background: #c82333;
        }
        
        .table-responsive {
            width: 100%;
            overflow-x: auto;
            margin-top: 30px;
        }
        .table {
            width: 100%;
            min-width: 900px;
            font-size: 14px;
            background: white;
            border-radius: 8px;
            border-collapse: separate;
            border-spacing: 0;
        }
        .table th, .table td {
            padding: 16px 14px;
            white-space: nowrap;
            vertical-align: top;
            min-height: 32px;
            line-height: 1.6;
            text-align: left;
        }
        .table td:last-child {
            text-align: center;
        }
        .table th {
            background: #f1f3f9;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        .table tr:nth-child(even) {
            background: #f8f9fa;
        }
        .table td {
            max-width: 180px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .table td.description {
            max-width: 350px;
            white-space: normal;
            word-break: break-word;
        }
        .country-group-row {
            background: #e3eafc;
            font-weight: bold;
            font-size: 16px;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-card">
            <div class="login-logo">üåç Rotam Benim</div>
            <div class="login-subtitle">Seyahat rotalarƒ±nƒ±zƒ± planlayƒ±n</div>
            
            <!-- Login Button -->
            <button id="googleSignInBtn" class="google-btn">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                    <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                    <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                    <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                </svg>
                Google ile Giri≈ü Yap
            </button>
            
            <!-- User Info (hidden by default) -->
            <div id="userInfo" class="user-info" style="display: none;">
                <div style="display: flex; align-items: center; margin-bottom: 15px;">
                    <img id="userAvatar" class="user-avatar" src="" alt="User Avatar">
                    <div>
                        <div id="userName" style="font-weight: 600; font-size: 16px;"></div>
                        <div id="userEmail" style="color: #626976; font-size: 14px;"></div>
                    </div>
                </div>
                <div id="userId" style="font-size: 12px; color: #626976; margin-bottom: 15px;"></div>
                <button id="logoutBtn" class="logout-btn">√áƒ±kƒ±≈ü Yap</button>
            </div>
            
            <!-- Status Messages -->
            <div id="statusMessage"></div>
            
            <!-- Filtreler -->
            <div id="filters" style="display: flex; gap: 16px; justify-content: flex-start; align-items: center; margin-bottom: 18px; margin-top: 18px;">
              <label for="countryFilter">√úlke:</label>
              <select id="countryFilter" style="min-width: 140px; padding: 6px 10px; border-radius: 6px; border: 1px solid #ccc;"></select>
              <label for="visitedFilter">Ziyaret:</label>
              <select id="visitedFilter" style="min-width: 120px; padding: 6px 10px; border-radius: 6px; border: 1px solid #ccc;">
                <option value="all">T√ºm√º</option>
                <option value="visited">Gezildi</option>
                <option value="notvisited" selected>Gezilmedi</option>
              </select>
            </div>
            
            <!-- Gezilecek Yerler Tablosu -->
            <div id="placesTableWrapper" class="table-responsive">
              <div id="placesTableContainer" style="margin-top: 0; display: none;">
                <h3>Gezilecek Yerler</h3>
                <table id="placesTable" class="table table-sm">
                  <thead>
                    <tr>
                      <th>Yer Adƒ±</th>
                      <th>≈ûehir</th>
                      <th>Kategori</th>
                      <th>A√ßƒ±klama</th>
                      <th>Ziyaret Edildi mi?</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- Satƒ±rlar buraya eklenecek -->
                  </tbody>
                </table>
              </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Firebase imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB6bIJOkooeRSKWtb09zdNmMIjHDbXCzYA",
            authDomain: "rotambenim.firebaseapp.com",
            projectId: "rotambenim",
            storageBucket: "rotambenim.firebasestorage.app",
            messagingSenderId: "374285362920",
            appId: "1:374285362920:web:b4058cf4a93e7337168b5d",
            measurementId: "G-0QVZ4LDYPJ"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // DOM elements
        const googleSignInBtn = document.getElementById('googleSignInBtn');
        const userInfo = document.getElementById('userInfo');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const userEmail = document.getElementById('userEmail');
        const userId = document.getElementById('userId');
        const logoutBtn = document.getElementById('logoutBtn');
        const statusMessage = document.getElementById('statusMessage');
        const placesTableContainer = document.getElementById('placesTableContainer');
        const placesTableBody = document.querySelector('#placesTable tbody');

        // Show status message
        function showStatus(message, type = 'info') {
            statusMessage.innerHTML = `<div class="status-${type}">${message}</div>`;
            setTimeout(() => {
                statusMessage.innerHTML = '';
            }, 5000);
        }

        // Handle Google Sign In
        async function handleGoogleSignIn() {
            try {
                googleSignInBtn.disabled = true;
                showStatus('Google ile giri≈ü yapƒ±lƒ±yor...', 'info');
                
                const provider = new GoogleAuthProvider();
                const result = await signInWithPopup(auth, provider);
                
                console.log('Giri≈ü ba≈üarƒ±lƒ±:', result.user);
                showStatus('Giri≈ü ba≈üarƒ±lƒ±!', 'success');
                
            } catch (error) {
                console.error('Giri≈ü hatasƒ±:', error);
                
                let errorMessage = 'Giri≈ü yapƒ±lƒ±rken bir hata olu≈ütu.';
                if (error.code === 'auth/popup-closed-by-user') {
                    errorMessage = 'Giri≈ü iptal edildi.';
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage = 'Aƒü hatasƒ±. ƒ∞nternet baƒülantƒ±nƒ±zƒ± kontrol edin.';
                } else if (error.code === 'auth/unauthorized-domain') {
                    errorMessage = 'Bu domain i√ßin giri≈ü yetkisi yok. Firebase Console\'da domain\'i ekleyin.';
                }
                
                showStatus(errorMessage, 'error');
                googleSignInBtn.disabled = false;
            }
        }

        // Handle Sign Out
        async function handleSignOut() {
            try {
                await signOut(auth);
                console.log('√áƒ±kƒ±≈ü ba≈üarƒ±lƒ±');
                showStatus('√áƒ±kƒ±≈ü yapƒ±ldƒ±.', 'success');
            } catch (error) {
                console.error('√áƒ±kƒ±≈ü hatasƒ±:', error);
                showStatus('√áƒ±kƒ±≈ü yapƒ±lƒ±rken hata olu≈ütu.', 'error');
            }
        }

        // Update UI based on auth state
        function updateUI(user) {
            if (user) {
                // User is signed in
                googleSignInBtn.style.display = 'none';
                userInfo.style.display = 'block';
                
                userName.textContent = user.displayName || 'Kullanƒ±cƒ±';
                userEmail.textContent = user.email || '';
                userId.textContent = `ID: ${user.uid}`;
                
                if (user.photoURL) {
                    userAvatar.src = user.photoURL;
                } else {
                    userAvatar.src = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjUiIGN5PSIyNSIgcj0iMjUiIGZpbGw9IiM2MjY5NzYiLz4KPHN2ZyB4PSIxMiIgeT0iMTIiIHdpZHRoPSIyNiIgaGVpZ2h0PSIyNiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJ3aGl0ZSI+CjxwYXRoIGQ9Ik0xMiAxMmMyLjIxIDAgNC0xLjc5IDQtNHMtMS43OS00LTQtNC00IDEuNzktNCA0IDEuNzkgNCA0IDR6bTAgMmMtMi42NyAwLTggMS4zNC04IDR2MmgxNnYtMmMwLTIuNjYtNS4zMy00LTgtNHoiLz4KPC9zdmc+Cjwvc3ZnPgo=';
                }
                
            } else {
                // User is signed out
                googleSignInBtn.style.display = 'flex';
                userInfo.style.display = 'none';
                googleSignInBtn.disabled = false;
            }
        }

        // Auth state listener
        onAuthStateChanged(auth, (user) => {
            console.log('Auth state changed:', user ? 'User signed in' : 'User signed out');
            updateUI(user);
            loadPlacesTable(user);
        });

        // Event listeners
        googleSignInBtn.addEventListener('click', handleGoogleSignIn);
        logoutBtn.addEventListener('click', handleSignOut);

        // Initialize
        console.log('Firebase initialized successfully');
        showStatus('Uygulama hazƒ±r. Giri≈ü yapabilirsiniz.', 'info');

        async function loadPlacesTable(user) {
          if (!user) {
            placesTableContainer.style.display = 'none';
            return;
          }
          // Kullanƒ±cƒ±ya ait places koleksiyonu yolu
          const placesCol = collection(db, `users/${user.uid}/places`);
          const snapshot = await getDocs(placesCol);

          // Tabloyu temizle
          placesTableBody.innerHTML = '';

          // Filtre comboboxlarƒ±nƒ± hazƒ±rla
          const countryFilter = document.getElementById('countryFilter');
          const visitedFilter = document.getElementById('visitedFilter');

          // T√ºm √ºlkeleri topla ve sƒ±rala
          const places = [];
          const countrySet = new Set();
          snapshot.forEach(doc => {
            const data = doc.data();
            places.push({ ...data, _docId: doc.id });
            if (data.country) countrySet.add(data.country);
          });
          const countries = Array.from(countrySet).sort();

          // √úlke combobox'ƒ±nƒ± doldur (sadece ilk y√ºklemede veya √ºlke sayƒ±sƒ± deƒüi≈ütiyse)
          if (countryFilter.options.length === 0 || countryFilter.options.length !== countries.length) {
            countryFilter.innerHTML = '';
            countries.forEach(c => {
              const opt = document.createElement('option');
              opt.value = c;
              opt.textContent = c;
              countryFilter.appendChild(opt);
            });
          }
          // Varsayƒ±lan √ºlke: ALMANYA
          if (!countryFilter.value) countryFilter.value = 'ALMANYA';
          // Varsayƒ±lan ziyaret filtresi: Gezilmedi
          visitedFilter.value = 'notvisited';

          // Filtreye g√∂re verileri s√ºz
          const selectedCountry = countryFilter.value;
          const selectedVisited = visitedFilter.value;
          let filtered = places.filter(p => p.country === selectedCountry);
          if (selectedVisited === 'visited') filtered = filtered.filter(p => p.visited);
          else if (selectedVisited === 'notvisited') filtered = filtered.filter(p => !p.visited);

          // √úlkeye g√∂re grupla kaldƒ±rƒ±ldƒ±, sadece se√ßili √ºlke g√∂sterilecek
          let currentCountry = null;
          filtered.sort((a, b) => (a.country || '').localeCompare(b.country || ''));
          filtered.forEach(data => {
            if (data.country !== currentCountry) {
              currentCountry = data.country;
              // √úlke ba≈ülƒ±ƒüƒ± satƒ±rƒ± ekle
              const countryRow = document.createElement('tr');
              countryRow.className = 'country-group-row';
              countryRow.innerHTML = `<td colspan="5">${currentCountry || 'Diƒüer'}</td>`;
              placesTableBody.appendChild(countryRow);
            }
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${data.name || ''}</td>
              <td>${data.city || ''}</td>
              <td>${data.category || ''}</td>
              <td class="description">${data.description || ''}</td>
              <td style="text-align:center;"><input type="checkbox" class="visited-checkbox" data-docid="${data._docId}" ${data.visited ? 'checked' : ''}></td>
            `;
            placesTableBody.appendChild(row);
          });

          // Checkbox event listener
          document.querySelectorAll('.visited-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', async (e) => {
              const docId = e.target.getAttribute('data-docid');
              const checked = e.target.checked;
              try {
                const placeDocRef = collection(db, `users/${user.uid}/places`);
                // Firestore doc() ile referans olu≈ütur
                const { doc, updateDoc } = await import('https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js');
                const ref = doc(db, `users/${user.uid}/places`, docId);
                await updateDoc(ref, { visited: checked });
              } catch (err) {
                alert('G√ºncelleme hatasƒ±: ' + err.message);
                e.target.checked = !checked; // Hata olursa eski haline d√∂nd√ºr
              }
            });
          });

          placesTableContainer.style.display = '';
        }

        // Filtre deƒüi≈üince tabloyu g√ºncelle
        document.addEventListener('DOMContentLoaded', () => {
          const countryFilter = document.getElementById('countryFilter');
          const visitedFilter = document.getElementById('visitedFilter');
          if (countryFilter && visitedFilter) {
            countryFilter.addEventListener('change', () => {
              const user = auth.currentUser;
              if (user) loadPlacesTable(user);
            });
            visitedFilter.addEventListener('change', () => {
              const user = auth.currentUser;
              if (user) loadPlacesTable(user);
            });
          }
        });
    </script>
</body>

</html> 